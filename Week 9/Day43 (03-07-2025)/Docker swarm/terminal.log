presidio@Presidios-MacBook-Pro Docker swarm % docker swarm init
Swarm initialized: current node (xynfrfk45gv5iz6vghdhv7z80) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-2wa1hbeo23noqt83b15jitolkplsoif2cimb1wmbt1xgte3ie2-7psz99nmrg4llp54nh3tgrzta 192.168.65.3:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.
presidio@Presidios-MacBook-Pro Docker swarm % docker build -t api:latest ./api
[+] Building 27.9s (11/11) FINISHED                                                                                                     docker:desktop-linux
 => [internal] load build definition from Dockerfile                                                                                                    0.0s
 => => transferring dockerfile: 178B                                                                                                                    0.0s
 => [internal] load metadata for docker.io/library/node:20-alpine                                                                                       5.2s
 => [auth] library/node:pull token for registry-1.docker.io                                                                                             0.0s
 => [internal] load .dockerignore                                                                                                                       0.0s
 => => transferring context: 2B                                                                                                                         0.0s
 => [1/5] FROM docker.io/library/node:20-alpine@sha256:674181320f4f94582c6182eaa151bf92c6744d478be0f1d12db804b7d59b2d11                                11.6s
 => => resolve docker.io/library/node:20-alpine@sha256:674181320f4f94582c6182eaa151bf92c6744d478be0f1d12db804b7d59b2d11                                 0.0s
 => => sha256:5432aa916e0868c8c9385ef60226d5ef530f13fe7c28fc13c054de1df6d006cd 42.99MB / 42.99MB                                                        7.3s
 => => sha256:2506673f55362e86b6c8a2ab9c01541ae636887386c92d06e01286d3ddd83871 1.26MB / 1.26MB                                                          1.2s
 => => sha256:98c4889b578e94078411d6c14fe8f5daa0303d43e82bbf84d5787ab657c42428 445B / 445B                                                              1.2s
 => => extracting sha256:5432aa916e0868c8c9385ef60226d5ef530f13fe7c28fc13c054de1df6d006cd                                                               4.1s
 => => extracting sha256:2506673f55362e86b6c8a2ab9c01541ae636887386c92d06e01286d3ddd83871                                                               0.1s
 => => extracting sha256:98c4889b578e94078411d6c14fe8f5daa0303d43e82bbf84d5787ab657c42428                                                               0.0s
 => [internal] load build context                                                                                                                       0.0s
 => => transferring context: 402B                                                                                                                       0.0s
 => [2/5] WORKDIR /app                                                                                                                                  0.5s
 => [3/5] COPY package.json .                                                                                                                           0.0s
 => [4/5] RUN npm install                                                                                                                               8.4s
 => [5/5] COPY index.js .                                                                                                                               0.1s 
 => exporting to image                                                                                                                                  1.7s 
 => => exporting layers                                                                                                                                 0.8s 
 => => exporting manifest sha256:23ea7d3bc69ef55926e36ea919aef40f21b5121309a218d6ec1ae56898565bdc                                                       0.0s
 => => exporting config sha256:4f349ae8f3c07f8b5c6876bbd307ccf845da47700fa7d4d99991d93b8ff86d5b                                                         0.0s
 => => exporting attestation manifest sha256:942c65a68948c6af69611dc62b2394ba7a4e67cc200a041c1e39758671080033                                           0.0s
 => => exporting manifest list sha256:91a7f0e1024c09be40fc48d590e6cec2aea7d62e062385a806efe9a160092ba2                                                  0.0s
 => => naming to docker.io/library/api:latest                                                                                                           0.0s
 => => unpacking to docker.io/library/api:latest                                                                                                        0.8s
presidio@Presidios-MacBook-Pro Docker swarm % docker build -t web:latest ./web
[+] Building 12.0s (8/8) FINISHED                                                                                                       docker:desktop-linux
 => [internal] load build definition from Dockerfile                                                                                                    0.0s
 => => transferring dockerfile: 131B                                                                                                                    0.0s
 => [internal] load metadata for docker.io/library/nginx:alpine                                                                                         5.0s
 => [auth] library/nginx:pull token for registry-1.docker.io                                                                                            0.0s
 => [internal] load .dockerignore                                                                                                                       0.0s
 => => transferring context: 2B                                                                                                                         0.0s
 => [internal] load build context                                                                                                                       0.0s
 => => transferring context: 224B                                                                                                                       0.0s
 => [1/2] FROM docker.io/library/nginx:alpine@sha256:b2e814d28359e77bd0aa5fed1939620075e4ffa0eb20423cc557b375bd5c14ad                                   6.1s
 => => resolve docker.io/library/nginx:alpine@sha256:b2e814d28359e77bd0aa5fed1939620075e4ffa0eb20423cc557b375bd5c14ad                                   0.0s
 => => sha256:92971aeb101e5e1df5c759e2cc239bdce76c34c09f356f428f4256e04039cef2 16.78MB / 16.78MB                                                        3.8s
 => => sha256:63dda2adf85bd92ed611cda1b94324396aefe5afe0b7b39a72b4ea6362c40552 1.21kB / 1.21kB                                                          1.4s
 => => sha256:b55ed7d7b2def46fd4870c4bb5743ffd31dae1da58ffd897893978b789c62943 1.40kB / 1.40kB                                                          1.5s
 => => sha256:2c127093dfc748d5aae28bdf3d96936deb033e69cb643eeb75d6070e4333f7c4 404B / 404B                                                              1.7s
 => => sha256:a9ff9baf1741d1f2a4a5df1b44b2f09931318cb1a9201f23a01cb295e0274768 955B / 955B                                                              0.6s
 => => sha256:fb746e72516f99f0b4f5204c47f8c2aa325a4a9d075769800c42548fe722b25d 627B / 627B                                                              0.9s
 => => sha256:3b7062d09e028c442f2b05e76286341d9b23a69a42b9ecd3d226911a5200bc86 1.81MB / 1.81MB                                                          2.5s
 => => extracting sha256:3b7062d09e028c442f2b05e76286341d9b23a69a42b9ecd3d226911a5200bc86                                                               0.4s
 => => extracting sha256:fb746e72516f99f0b4f5204c47f8c2aa325a4a9d075769800c42548fe722b25d                                                               0.0s
 => => extracting sha256:a9ff9baf1741d1f2a4a5df1b44b2f09931318cb1a9201f23a01cb295e0274768                                                               0.0s
 => => extracting sha256:2c127093dfc748d5aae28bdf3d96936deb033e69cb643eeb75d6070e4333f7c4                                                               0.0s
 => => extracting sha256:63dda2adf85bd92ed611cda1b94324396aefe5afe0b7b39a72b4ea6362c40552                                                               0.0s
 => => extracting sha256:b55ed7d7b2def46fd4870c4bb5743ffd31dae1da58ffd897893978b789c62943                                                               0.0s
 => => extracting sha256:92971aeb101e5e1df5c759e2cc239bdce76c34c09f356f428f4256e04039cef2                                                               1.1s
 => [2/2] COPY index.html /usr/share/nginx/html/index.html                                                                                              0.2s
 => exporting to image                                                                                                                                  0.3s
 => => exporting layers                                                                                                                                 0.1s
 => => exporting manifest sha256:f09e9ad21b69e201bffee7bb6615d532563760039bfce4b718422b1fb2e7932b                                                       0.0s
 => => exporting config sha256:765216521ac75c3348ca65a6e49588cdff61e3930bdc0737a6732b1fca05e033                                                         0.0s
 => => exporting attestation manifest sha256:1bd71bd8af27508bcedb9dd09019a1a264669e3f9b650c9e8add796c95fbce70                                           0.0s
 => => exporting manifest list sha256:529a6a924c12cb22d48caca53ad3b97121f726c32a262d0e73d674566bc3cc05                                                  0.0s
 => => naming to docker.io/library/web:latest                                                                                                           0.0s
 => => unpacking to docker.io/library/web:latest                                                                                                        0.0s
presidio@Presidios-MacBook-Pro Docker swarm % docker stack deploy -c docker-compose.yml newstack
Since --detach=false was not specified, tasks will be created in the background.
In a future release, --detach=false will become the default.
Creating network newstack_default
Creating service newstack_web
Creating service newstack_api
presidio@Presidios-MacBook-Pro Docker swarm % docker stack services newstack
ID             NAME           MODE         REPLICAS   IMAGE        PORTS
e684ztfcga8f   newstack_api   replicated   2/2        api:latest   *:3000->3000/tcp
8mwg5tb1mznu   newstack_web   replicated   2/2        web:latest   *:8080->80/tcp
presidio@Presidios-MacBook-Pro Docker swarm % docker service ls 
ID             NAME           MODE         REPLICAS   IMAGE        PORTS
e684ztfcga8f   newstack_api   replicated   2/2        api:latest   *:3000->3000/tcp
8mwg5tb1mznu   newstack_web   replicated   2/2        web:latest   *:8080->80/tcp
presidio@Presidios-MacBook-Pro Docker swarm % docker service scale newstack_web=3
newstack_web scaled to 3
overall progress: 3 out of 3 tasks 
1/3: running   [==================================================>] 
2/3: running   [==================================================>] 
3/3: running   [==================================================>] 
verify: Service newstack_web converged 
presidio@Presidios-MacBook-Pro Docker swarm % docker service ls        
ID             NAME           MODE         REPLICAS   IMAGE        PORTS
e684ztfcga8f   newstack_api   replicated   2/2        api:latest   *:3000->3000/tcp
8mwg5tb1mznu   newstack_web   replicated   3/3        web:latest   *:8080->80/tcp
presidio@Presidios-MacBook-Pro Docker swarm % docker stack rm newstack
Removing service newstack_api
Removing service newstack_web
Removing network newstack_default
presidio@Presidios-MacBook-Pro Docker swarm % docker service ls       
ID        NAME      MODE      REPLICAS   IMAGE     PORTS
presidio@Presidios-MacBook-Pro Docker swarm % docker swarm leave --force
Node left the swarm.
presidio@Presidios-MacBook-Pro Docker swarm % 